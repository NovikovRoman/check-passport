# Check Passport

> Библиотека для проверки статуса паспортов РФ

Данные являются информационными, предоставляемая информация не является юридически значимой. Данные
получает из [сервиса ГУВМ МВД РФ](http://xn--b1afk4ade4e.xn--b1ab2a0a.xn--b1aew.xn--p1ai/info-service.htm?sid=2000).

При проверке не учитывается специальный тираж (в связи с особенностью технологического процесса в 1997 году изготовлены
бланки паспортов специального тиража и одновременно начато их серийное производство).

Нумерация в специальном тираже:

- для всех субъектов (регионов) Российской Федерации (за исключением Москвы, Московской области, г. Санкт-Петербурга и
  Ленинградской области) номера бланков паспорта начинаются с цифры 1 и заканчивается цифрой 10.

- для г. Москвы установлен номер от 1 до 100, для Московской области — от 1 до 50, для г. Санкт-Петербурга — от 1 до 30,
  для Ленинградской области — от 1 до 20.

- для Ленинградской области паспорта с номерами от 21 до 100 не печатались, для Московской области с номерами от 51 до
  100, для г. Санкт-Петербурга с номерами — от 31 до 100, для всех других субъектов Российской Федерации с номерами от
  11 до 100.

## Структура БД

База данных находится в указанной вами директории, которая, в свою очередь, содержит директорию с именем
db_[количество сведений на текущий момент] и обязательную ссылку `current` на данную директорию. База содержит только
записи паспортов РФ с номерами вида `0000 000000`.

База данных хранится в отдельных файлах каждой серии паспортов. Файлы содержат отсортированные номера недействительных
паспортов в формате `uint32`.

## Использование

### Обновление БД паспортов или разворачивание новой БД.

```go
var (
    ok bool
    numPassports int
    err error
)

dst := "your/path/for/db"
dbPassports := check_passport.NewDB(dst, nil)
ctx := context.Background()

// context необязателен, можно отправить nil
if ok, numPassports, err = dbPassports.Update(ctx); err != nil {
    log.Fataln(err)
}

if ok {
    log.Println("Успешно. Записей", numPassports)
} else {
    log.Println("Нет обновлений")
}
```

Операция довольно долгая. Зависит от скорости компьютера и сети. Выполняется в среднем до 6 мин (порядка 3 млн записей).

### Проверка паспорта

```go
if ok, err = dbPassports.IsValid("9723", "123456"); err != nil {
    log.Fataln(err)
}

if ok {
    log.Println("Паспорт среди недействительных не значится.")
} else {
    log.Println("Паспорт недействителен.")
}
```

### Проверка допустимости серии паспорта
```go
series := "0012"
// ok = false, в ОКАТО регионов нет кода "00"
ok := dbPassports.AllowableSeries(series)
```

```go
series := "9712"
// ok = true
ok := dbPassports.AllowableSeries(series)
```

### Проверка допустимости номера паспорта

```go
number := "000090"
// ok = false, номера должны начинаться со 101.
ok := dbPassports.AllowableNumber(number)
```

```go
number := "123456"
// ok = true
ok := dbPassports.AllowableNumber(number)
```